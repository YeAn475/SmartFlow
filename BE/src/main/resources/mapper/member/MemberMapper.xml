<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.springboot.smartflow.domain.member.mapper.MemberMapper">

    <select id="findByEmail" resultType="com.springboot.smartflow.entity.User">
        SELECT 
            user_id       AS userId,
            department_id AS departmentId,
            email,
            password,
            name,
            role,
            total_leave   AS totalLeave,
            remain_leave  AS remainLeave,
            provider,
            provider_id   AS providerId,
            is_deleted    AS isDeleted,
            user_status   AS userStatus,
            created_at    AS createdAt,
            updated_at    AS updatedAt
        FROM "user" 
        WHERE email = #{email}
    </select>

    <insert id="save" useGeneratedKeys="true" keyProperty="userId">
        INSERT INTO "user" (
            email,
            password,
            name,
            role,
            department_id,
            total_leave,
            remain_leave
        ) VALUES (
            #{email},
            #{password},
            #{name},
            COALESCE(#{role}::user_role_enum, 'USER'::user_role_enum),
            COALESCE(#{departmentId}, 1),
            15,
            15
        )
    </insert>
    
</mapper>
