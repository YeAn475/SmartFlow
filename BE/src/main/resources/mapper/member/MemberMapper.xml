<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.springboot.smartflow.domain.member.mapper.MemberMapper">
    <select id="findByEmail" resultType="com.springboot.smartflow.entity.User">
        SELECT * FROM "user" WHERE email = #{email}
    </select>

    <insert id="save" useGeneratedKeys="true" keyProperty="userId">
        INSERT INTO "user" (
            email,
            password,
            name,
            role,
            department_id,
            total_leave,
            remain_leave
        ) VALUES (
                     #{email},
                     #{password},
                     #{name},
                     COALESCE(#{role}::user_role, 'USER'::user_role), -- role이 null이면 USER로 캐스팅
                     COALESCE(#{departmentId}, 1),                   -- departmentId가 null이면 1
                     15,
                     15
                 )
    </insert>
</mapper>